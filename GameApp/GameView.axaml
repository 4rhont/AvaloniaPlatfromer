<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:GameApp.Core.ViewModels;assembly=GameApp.Core"
        xmlns:converters="clr-namespace:GameApp.Converters"
        xmlns:views="clr-namespace:GameApp.Views"
        xmlns:vmAnim="clr-namespace:GameApp.ViewModels;assembly=GameApp"
        x:Class="GameApp.Views.GameView"
		x:Name="gameView"
        x:DataType="vm:GameViewModel"
        Title="Platformer - Textures"
        Width="1920"
        Height="1080"
        Focusable="True">

	<Window.Resources>
		<converters:BoolToScaleXConverter x:Key="BoolToScaleConverter"/>
	</Window.Resources>

	<Grid>
		<!-- Мир двигается камерой -->
		<Canvas x:Name="MainCanvas" Background="DarkBlue">

			<!-- Игрок -->
			<Image x:Name="PlayerImage"
                   x:DataType="vmAnim:PlayerAnimationViewModel"
                   Width="{Binding VisualWidth}"
                   Height="{Binding VisualHeight}"
                   Canvas.Left="{Binding VisualX}"
                   Canvas.Top="{Binding VisualY}"
                   Source="{Binding CurrentFrameBitmap}"
                   RenderTransformOrigin="50%,50%">
				<Image.RenderTransform>
					<ScaleTransform
                        ScaleX="{Binding IsFacingRight, Converter={StaticResource BoolToScaleConverter}}"
                        ScaleY="1"/>
				</Image.RenderTransform>
			</Image>

			<ItemsControl ItemsSource="{Binding #gameView.EnemyViewModels}">
				<ItemsControl.ItemsPanel>
					<ItemsPanelTemplate>
						<Canvas />
					</ItemsPanelTemplate>
				</ItemsControl.ItemsPanel>
				<ItemsControl.ItemTemplate>
					<DataTemplate>
						<Image Width="{Binding VisualWidth}"
							   Height="{Binding VisualHeight}"
							   Canvas.Left="{Binding VisualX}"
							   Canvas.Top="{Binding VisualY}"
							   Source="{Binding CurrentFrameBitmap}"
							   Stretch="Uniform"
							   RenderTransformOrigin="0.5,0.5"
							   IsHitTestVisible="False">
							<Image.RenderTransform>
								<ScaleTransform ScaleX="{Binding EnemyScaleX}" ScaleY="1"/>
							</Image.RenderTransform>
						</Image>
					</DataTemplate>
				</ItemsControl.ItemTemplate>
			</ItemsControl>
			<!-- Погода -->
			<views:WeatherLayer x:Name="WeatherLayer" Width="10000" Height="3000"/>

			<!-- Debug hitboxes двигаются камерой -->
			<Canvas x:Name="DebugCanvas"
                    Canvas.ZIndex="1000"
                    IsHitTestVisible="False"/>
		</Canvas>

		<!-- Debug overlay не двигается камерой -->
		<Border HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="10"
                Background="#AA000000"
                Padding="8"
                CornerRadius="6"
                IsHitTestVisible="False">
			<TextBlock Width="500"
                       Text="{Binding DebugInfo}"
                       Foreground="White"
                       FontSize="14"
                       TextWrapping="Wrap"/>
		</Border>

		<!-- Подсказка по управлению -->
		<TextBlock HorizontalAlignment="Left"
                   VerticalAlignment="Bottom"
                   Margin="10"
                   Text="Controls: WASD/arrows, Space=Jump, LMB=Attack"
                   Foreground="White"
                   FontSize="14"/>
	</Grid>
</Window>